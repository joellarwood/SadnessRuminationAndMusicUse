---
title: "Study 1"
output:
  github_document:
    toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ez)
library(apa)
library(visdat)
library(emmeans)
library(sjPlot)
library(sjmisc)
library(skimr)
library(psych)
library(multcomp)
library(ggridges)
library(ggrepel)
```

```{r load S1, message=FALSE, warning = FALSE}
s1raw <- read_csv("../data/s1.csv") 

names(s1raw)
```

# Create Scores 

```{r scores}
s1dat <- s1raw %>% 
  mutate(Baseline = rowSums(dplyr::select(., POMSDSF1_1:POMSDSF8_1)),
         PostInduction = rowSums(dplyr::select(., POMSDSF1_2:POMSDSF8_2)),
         PostListening = rowSums(dplyr::select(., POMSDSF1_3:POMSDSF8_3)),
         MARS_Pos = rowMeans(dplyr::select(., MARS1_1,
                                    MARS2_1,
                                    MARS6_1,
                                    MARS7_1, 
                                    MARS8_1,
                                    MARS9_1,
                                    MARS11_1,
                                    MARS12_1,
                                    MARS14_1,
                                    MARS15_1)),
         MARS_Neg = rowMeans(dplyr::select(., MARS3_1,
                                    MARS4_1,
                                    MARS5_1,
                                    MARS10_1,
                                    MARS13_1)),
         RRQ6_1 = 6 - .$RRQ6_1,
         RRQ9_1 = 6 - .$RRQ9_1,
         RRQ10_1 = 6 - .$RRQ10_1, 
         Condition = as.factor(Condition),
         Condition = fct_recode(Condition, 
                                "Control" = "1", 
                                "Self Selected" = "2",
                                "Experimeter Selected" = "3")
         ) 

s1dat <- s1dat %>%  mutate(Rumination = rowMeans(dplyr::select(., RRQ1_1:RRQ12_1)))
s1dat <- s1dat %>% mutate(RumSplit = dicho(.$Rumination, val.labels = c("Low Rumiantion", "High Rumination")))

s1dat %>% 
  dplyr::select(Baseline, PostInduction, PostListening, Rumination, MARS_Pos, MARS_Neg) %>%
  skimr::skim() %>% 
  skimr::kable()

```

# Reliabilities 
```{r alphas}
# Baseline ALpha 
psych::alpha(dplyr::select(s1dat, POMSDSF1_1:POMSDSF8_1 ))$total$raw_alpha

# Post Induction Alpha
psych::alpha(dplyr::select(s1dat, POMSDSF1_2:POMSDSF8_2 ))$total$raw_alpha

# Post Listening Alpha 
psych::alpha(dplyr::select(s1dat, POMSDSF1_3:POMSDSF8_3 ))$total$raw_alpha

# Rumination Alpha 
psych::alpha(dplyr::select(s1dat, RRQ1_1:RRQ12_1 ))$total$raw_alpha

# MARS Positive Alpha 
psych::alpha(dplyr::select(s1dat, MARS1_1,
                    MARS2_1,
                    MARS6_1,
                    MARS7_1, 
                    MARS8_1,
                    MARS9_1,
                    MARS11_1,
                    MARS12_1,
                    MARS14_1,
                    MARS15_1))$total$raw_alpha


#MARS Negative Alpha 
psych::alpha(dplyr::select(s1dat, MARS3_1,
                    MARS4_1,
                    MARS5_1,
                    MARS10_1,
                    MARS13_1))$total$raw_alpha

```


## ANOVA 

<<<<<<< HEAD

ANOVAs1 <- afex::aov_ez(id = "id",
                        data = s1long,
                        dv = "Sadness",
                        between = c("Condition", "RumSplit"),
                        within = "Timepoint",
                        type = 2)
=======
```{r}
s1long <- gather (
  s1dat,
  key = Timepoint,
  value = Sadness,
  Baseline, PostInduction, PostListening
)
>>>>>>> master

ANOVAs1 <- afex::aov_car(
  formula = Sadness ~ Timepoint*Condition*RumSplit + Error(id/Timepoint),
  data = s1long,
  type = 2,
)

<<<<<<< HEAD



afex_plot(ANOVAs1,
          x = "Timepoint",
          trace = "Condition",
          error = "within",
          mapping = "color",
          data_plot = FALSE) +
  scale_x_discrete(labels = c("Baseline", "Post Induction", "Post Listening")) +
  scale_color_discrete(labels = c("No Music \nControl", "Experimenter Selected \nMusic", "Participant Selected \nMusic")) +
  ggplot2::ylim(0, 15) +
  ggplot2::theme_classic(base_size = 12, 
                         base_family = "Times New Roman") +
  ggplot2::theme(legend.title = element_blank()) 


summary(emmeans(ANOVAs1, pairwise ~  Timepoint))

s1time <- emmeans(ANOVAs1, pairwise ~ Timepoint | Condition)

contrast(s1time,
         interaction = "pairwise")$emmeans 
```
=======
afex::nice(ANOVAs1)

afex::afex_plot(ANOVAs1,
                x = "Timepoint",
                trace = "Condition", 
                mapping = "color",
                data_plot = FALSE) +
  ggplot2::theme_classic() + 
  ggplot2::scale_x_discrete(labels = c("Baselie", "Post Induction", "Post Listening")) +
  ggplot2::ylim(0, 15) +
  ggplot2::theme(legend.title = element_blank())

pairs(emmeans(ANOVAs1, ~ Timepoint|Condition))

```

## Rumination Correlation 
```{r}
s1dat %>% 
  dplyr::select("Rumination", "MARS_Neg", "MARS_Pos") %>% 
  apaTables::apa.cor.table(filename = "s1MARScor.txt",
                 landscape = FALSE)
```

# Exploratory Analysis of Spotify variables 

# Describe
```{r spotifydescribe}
s1dat %>% 
  dplyr::select(contains("track"),
         contains("ness"),
         energy,
         mode,
         valence,
         duration_ms,
         tempo,
         time_signature,
         artist_name) %>% 
  skimr::skim() %>% 
  skimr::kable(digits = 3)

s1dat %>% 
  tidyr::gather(key = Characteristic,
                value = value,
                valence, energy, acousticness, danceability) %>% 
  ggplot2::ggplot(aes(x = value, y = Characteristic, color = Characteristic, fill = Characteristic)) + 
  ggridges::geom_density_ridges() + 
  ggplot2::xlim(0,1) +
  ggplot2::theme_minimal() 

s1dat %>%
  dplyr::select(valence, energy, acousticness, danceability) %>% 
  apaTables::apa.cor.table()
>>>>>>> master

`

s1dat %>% 
  filter(mode == "minor" | mode == "major" & !is.na(track_name)) %>% 
  ggplot2::ggplot(aes(x = valence,
                      y = energy,
                      color = mode)) +
  facet_wrap(~ mode, ncol = 2) +
  geom_point() +
  geom_hline(yintercept = .5) +
  geom_vline(xintercept =.5) +
  ylim(0,1) +
  xlim(0,1) +


  ggplot2::geom_point(aes(color = mode)) +
  ggplot2::geom_hline(yintercept = .5) +
  ggplot2::geom_vline(xintercept =.5) + 
  ggplot2::ylim(0,1) + 
  ggplot2::xlim(0,1)




```
